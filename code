import discord
import random
import os
from discord.ext import commands

TOKEN = os.getenv("DISCORD_TOKEN")  # RÃ©cupÃ¨re le token depuis Railway
GUILD_ID = int(os.getenv("GUILD_ID"))  # ID du serveur Discord
WELCOME_CHANNEL_ID = int(os.getenv("WELCOME_CHANNEL_ID"))  # ID du salon de bienvenue

intents = discord.Intents.default()
intents.members = True  # Active l'intent des nouveaux membres
bot = commands.Bot(command_prefix="!", intents=intents)

# Messages de bienvenue alÃ©atoires
welcome_messages = [
    """â˜ *Un lÃ©ger brouillard sâ€™Ã©lÃ¨ve, et lorsque la brume se dissipeâ€¦ une nouvelle Ã¢me se tient parmi nous.*
âœ¨ Bienvenue, {membre} ! Lumharel tâ€™accueille. Prenez un instant pour lui souhaiter la bienvenue !""",
    """ğŸ”¥ *Une flamme vacille dans lâ€™air avant de sâ€™Ã©lever doucementâ€¦ Une prÃ©sence nouvelle sâ€™ancre dans le monde.*
ğŸŒŸ {membre} vient dâ€™Ãªtre invoquÃ©(e) en Lumharel ! Faites-lui un accueil chaleureux !""",
    """ğŸŒª *Le vent porte un murmure Ã  travers les terresâ€¦ Une voix nouvelle rÃ©sonne dans Lumharel.*
ğŸŒ {membre} a rejoint notre monde ! Laissez-lui un message pour guider ses premiers pas !""",
    """âœ¨ *Un Ã©clat de lumiÃ¨re traverse le cielâ€¦ Un fragment du destin vient de sâ€™incarner.*
ğŸ”” {membre}, bienvenue parmi nous ! Prenez un instant pour le saluer et lâ€™orienter !""",
    """ğŸ¦‰ *Un cri lointain retentit dans la nuit, annonÃ§ant un nouvel arrivant sous la protection des astres.*
ğŸ“œ {membre} rejoint Lumharel ! Que sa quÃªte commenceâ€¦ Souhaitez-lui un bon dÃ©part !"""
]

# Messages de bienvenue en DM
dm_messages = [
    "ğŸŒª *Le vent murmure ton arrivÃ©e...* {user}, ta place est Ã  dÃ©couvrir. Rejoins le canal #salons-et-rÃ´les !",
    "ğŸ”¥ *Une braise rougeoyante danse dans lâ€™airâ€¦* {user}, une nouvelle flamme sâ€™Ã©veille en Lumharel. Direction #salons-et-rÃ´les !",
    "âœ¨ *Un scintillement traverse lâ€™air...* {user}, lâ€™ombre et la lumiÃ¨re tâ€™accueillent. Trouve ta voie et rejoins le voyageâ€¦ #salons-et-rÃ´les !"
]

@bot.event
async def on_ready():
    print(f'âœ… {bot.user} est connectÃ© !')

@bot.event
async def on_member_join(member):
    guild = bot.get_guild(GUILD_ID)
    channel = guild.get_channel(WELCOME_CHANNEL_ID)
    
    if channel:
        welcome_text = random.choice(welcome_messages).replace("{user}", member.mention)
        await channel.send(welcome_text)
    
    try:
        dm_text = random.choice(dm_messages).replace("{user}", member.name)
        await member.send(dm_text)
    except:
        print(f"âŒ Impossible d'envoyer un DM Ã  {member.name}")

bot.run(TOKEN)
